# Weather Station Project

## Project Overview
[Project Presentation Video](https://youtu.be/_bfbdHETk4o)

## Links
[Streamlit](https://streamlit-ukfss2zija-oa.a.run.app/)
[Backend](https://backend-ukfss2zija-oa.a.run.app)


## Project Overview
This project focuses on developing a comprehensive weather station using the M5Stack, coupled with a frontend and backend system to provide a detailed view of both indoor and outdoor weather conditions.

### Team Members
- Jonathan Stefanov (Backend + M5 Stack)
- Mehdi Belkhiria (Streamlit + M5 Stack)

## Components

### M5Stack Features
- **Indoor Metrics**: Measures air quality, temperature, pressure, and humidity.
- **Outdoor Metrics**: Captures outdoor temperature and forecasts.
- **Additional Features**:
  - Text-to-Speech with Gemini for weather advice.
  - Automatic Wi-Fi connection and updates.
  - Error reporting through backend integration.
- **WiFi Management**:
  - Downloads and updates WiFi settings from the backend.
  - Attempts to connect to WiFi networks stored on an SD card and updates connection status.
- **Environmental Data Handling**:
  - Regularly updates indoor environmental data such as temperature, humidity, CO2 levels, and air pressure.
  - Sends this data to the backend for storage and further processing.
- **Display and Notifications**:
  - Downloads and displays images generated by the backend based on current weather data.
  - Plays Text-to-Speech audio notifications based on motion detection and current weather status.

### Frontend (Streamlit)
- **Functionality**:
  - Displays detailed indoor and outdoor weather data along with forecasts.
  - Provides historical weather graphs.
  - Allows for personalization, such as uploading new Wi-Fi details and changing device names.

### Backend
- **Infrastructure**:
  - Automatic builds with Cloud Run from GitHub.
  - Backend service is powered by Gunicorn.
- **Data Source**: Retrieves outdoor weather data from weatherapi.com.
- **Security**: Features a decorator for authorized endpoints with token authentication.
- **Integration**: Supports capabilities of both Streamlit and M5Stack.
- **Key Endpoints**:
  - **Weather Data Upload and Retrieval**: Allows uploading indoor weather data and fetching both indoor and outdoor weather data.
  - **Image and TTS Generation**: Supports generating images and text-to-speech audio based on weather data.
  - **Wi-Fi Management**: Provides endpoints to manage Wi-Fi settings stored in the system.
  - **User Configuration**: Endpoints for updating user-related settings like display name.
  - **Health Check**: Monitors and reports the health of the application.
  - **Error Logging**: Captures and logs errors through a dedicated endpoint.
  - **Shutdown Handling**: Properly handles application shutdown signals to ensure graceful termination.

## How to Replicate

1. **Clone the Repository**:
   - Clone the three parts of the project from GitHub:
   [Backend](https://github.com/JonathanStefanov/gcp-project-backend)
   [Streamlit](https://github.com/Mbelki/M5_weather_streamlit)
   [M5Stack](https://github.com/Mbelki/m5Stack_Station_Weather))

  
2. **Hardware Setup**:
   - Assemble your M5Stack with the necessary units. ENV3 needs to be connect to port A, TVOC to port C and PIR to port B.
   - Ensure the SD card is inserted with initial Wi-Fi settings in JSON format, this file should be named wifisettings.json and should contain json objects with wifi name and password.

3. **Software Dependencies**:
   - Install all required libraries for both the M5Stack and the backend server.
   - For the M5Stack, use UIFlow, and for the backend, ensure Python dependencies are installed using:
     ```
     pip install -r requirements.txt
     ```
   - Make sure to change the backend URL in the Streamlit and M5Stack code.
     

4. **Backend Setup**:
   - Set up the backend on a server or locally. Configure environment variables including `AUTH_TOKEN` for secure access.

5. **Frontend Setup**:
   - Run the Streamlit app locally or deploy it to a service like Streamlit sharing.

